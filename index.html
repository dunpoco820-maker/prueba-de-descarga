<script>
        async function descargar() {
            const input = document.getElementById('urlInput');
            const btn = document.getElementById('btn');
            const loading = document.getElementById('loading');
            const resultado = document.getElementById('resultado');
            
            if(!input.value) return alert("¡Pega un enlace primero!");

            loading.classList.remove('hidden');
            resultado.classList.add('hidden');
            btn.disabled = true;

            try {
                // Quitamos configuraciones pesadas para que sea más rápido y no lo bloqueen
                const res = await fetch('https://api.cobalt.tools/api/json', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({
                        url: input.value,
                        isNoWatermark: true
                    })
                });

                const data = await res.json();

                // Si es un Reel o Video directo
                if (data.url) {
                    document.getElementById('linkFinal').href = data.url;
                    loading.classList.add('hidden');
                    resultado.classList.remove('hidden');
                } 
                // Si es una Historia con varias imágenes o videos (picker)
                else if (data.picker && data.picker.length > 0) {
                    document.getElementById('linkFinal').href = data.picker[0].url;
                    loading.classList.add('hidden');
                    resultado.classList.remove('hidden');
                } else {
                    throw new Error();
                }
            } catch (e) {
                loading.classList.add('hidden');
                alert("Intenta de nuevo. Si persiste, prueba copiar el enlace desde una pestaña de incógnito de Instagram.");
            } finally {
                btn.disabled = false;
            }
        }
    </script>
