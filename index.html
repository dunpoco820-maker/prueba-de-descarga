<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaStory Downloader - Sin Marca de Agua</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-purple-700 via-pink-600 to-orange-500 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md bg-white/10 backdrop-blur-lg p-8 rounded-3xl border border-white/20 shadow-2xl text-center">
        <div class="mb-4">
            <i class="fab fa-instagram text-6xl text-white"></i>
        </div>
        
        <h1 class="text-2xl font-bold text-white mb-6">Descargar Historias</h1>

        <div class="relative mb-6">
            <input 
                type="text" 
                id="storyUrl" 
                placeholder="Pega el link de la historia aquí..." 
                class="w-full bg-white/20 border border-white/30 rounded-xl px-4 py-4 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all"
            >
        </div>

        <button 
            onclick="downloadStory()" 
            id="mainBtn"
            class="w-full bg-white text-purple-700 font-bold py-4 rounded-xl hover:bg-opacity-90 transition-all transform active:scale-95 shadow-lg"
        >
            <i class="fas fa-magic mr-2"></i> Obtener Contenido
        </button>

        <div id="loader" class="hidden mt-6">
            <div class="animate-spin inline-block w-8 h-8 border-4 border-white/30 border-t-white rounded-full"></div>
            <p class="text-white mt-2 text-sm">Extrayendo historia...</p>
        </div>

        <div id="result" class="hidden mt-8 pt-6 border-t border-white/20">
            <a id="downloadLink" href="#" target="_blank" class="flex items-center justify-center gap-2 bg-green-500 text-white font-bold py-3 rounded-full hover:bg-green-400 transition-all animate-bounce">
                <i class="fas fa-cloud-download-alt"></i> Guardar Historia
            </a>
            <p class="text-white/70 text-xs mt-4 italic">El video se abrirá en alta calidad y sin marcas.</p>
        </div>
    </div>

    <script>
        async function downloadStory() {
            const url = document.getElementById('storyUrl').value;
            const loader = document.getElementById('loader');
            const result = document.getElementById('result');
            const mainBtn = document.getElementById('mainBtn');

            if (!url || !url.includes('instagram.com')) {
                alert("Por favor, pega un enlace válido de Instagram.");
                return;
            }

            // UI Reset
            loader.classList.remove('hidden');
            result.classList.add('hidden');
            mainBtn.disabled = true;
            mainBtn.style.opacity = "0.7";

            try {
                // Conexión con el motor de descarga
                const response = await fetch("https://api.cobalt.tools/api/json", {
                    method: "POST",
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        url: url,
                        vCodec: "h264",
                        isNoWatermark: true
                    })
                });

                const data = await response.json();

                if (data.url || (data.picker && data.picker.length > 0)) {
                    const finalUrl = data.url || data.picker[0].url;
                    document.getElementById('downloadLink').href = finalUrl;
                    
                    loader.classList.add('hidden');
                    result.classList.remove('hidden');
                } else {
                    throw new Error("No se pudo obtener el archivo.");
                }
            } catch (error) {
                alert("Error: No pudimos acceder a esa historia. Asegúrate de que la cuenta sea PÚBLICA.");
                loader.classList.add('hidden');
            } finally {
                mainBtn.disabled = false;
                mainBtn.style.opacity = "1";
            }
        }
    </script>
</body>
</html>
